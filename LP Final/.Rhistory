lp_data <- lp_data %>% group_by(budget_v) %>% summarise_each(funs(mean,sd,se=sd(.)/sqrt(n()))) %>% ungroup()
greedy_data <- greedy_data %>% group_by(budget_v) %>% summarise_each(funs(mean,sd,se=sd(.)/sqrt(n()))) %>% ungroup()
ate_data <- ate_data %>% group_by(budget_v) %>% summarise_each(funs(mean,sd,se=sd(.)/sqrt(n()))) %>% ungroup()
ggplot() +
geom_line(data=greedy_data, aes(budget_v, total_utility_greedy_mean, colour="Greedy Algorithm")) +
geom_ribbon(data=greedy_data, aes(x=budget_v, y=total_utility_greedy_mean,ymin=total_utility_greedy_mean+total_utility_greedy_sd, ymax=total_utility_greedy_mean-total_utility_greedy_sd), alpha=0.2, fill = "grey70") +
geom_line(data=lp_data, aes(budget_v, total_utility_lp_mean, colour="HTE_MAX")) +
geom_ribbon(data=lp_data, aes(x=budget_v, y=total_utility_lp_mean,ymin=total_utility_lp_mean+total_utility_lp_sd, ymax=total_utility_lp_mean-total_utility_lp_sd), alpha=0.2, fill = "grey70") +
geom_line(data=ate_data, aes(budget_v, total_utility_ate_mean, colour="ATE")) +
geom_ribbon(data=ate_data, aes(x=budget_v, y=total_utility_ate_mean,ymin=total_utility_ate_mean+total_utility_ate_sd, ymax=total_utility_ate_mean-total_utility_ate_sd), alpha=0.2, fill = "grey70") +
labs(x = "Budget in $", y = "Utility in $", title ="Graph of Budget Vs. Utility", color='Allocation Methods') +
ggsave("./plots/plots_ci/plot_utility.png", width = 8, height = 5)
ggplot() +
geom_line(data=greedy_data, aes(budget_v, users_served_mean, colour="Greedy Algorithm")) +
geom_ribbon(data=greedy_data, aes(x=budget_v, y=users_served_mean,ymin=users_served_mean+users_served_sd, ymax=users_served_mean-users_served_sd), alpha=0.2, fill = "grey70") +
geom_line(data=lp_data, aes(budget_v, users_served_mean, colour="HTE_MAX")) +
geom_ribbon(data=lp_data, aes(x=budget_v, y=users_served_mean,ymin=users_served_mean+users_served_sd, ymax=users_served_mean-users_served_sd), alpha=0.2, fill = "grey70") +
geom_line(data=ate_data, aes(budget_v, num_users_ate_mean, colour="ATE")) +
geom_ribbon(data=ate_data, aes(x=budget_v, y=num_users_ate_mean,ymin=num_users_ate_mean+num_users_ate_sd, ymax=num_users_ate_mean-num_users_ate_sd), alpha=0.2, fill = "grey70") +
labs(x = "Budget in $", y = "No. of Users served", title ="Graph of Budget Vs. No. of Users served", color='Allocation Methods') +
ggsave("./plots/plots_ci/plot_user.png", width = 8, height = 5)
ggplot() +
geom_line(data=greedy_data, aes(budget_v, total_cost_greedy_mean, colour="Greedy Algorithm")) +
geom_ribbon(data=greedy_data, aes(x=budget_v, y=total_cost_greedy_mean,ymin=total_cost_greedy_mean+total_cost_greedy_sd, ymax=total_cost_greedy_mean-total_cost_greedy_sd), alpha=0.2, fill = "grey70") +
geom_line(data=lp_data, aes(budget_v, total_cost_lp_mean, colour="HTE_MAX")) +
geom_ribbon(data=lp_data, aes(x=budget_v, y=total_cost_lp_mean,ymin=total_cost_lp_mean+total_cost_lp_sd, ymax=total_cost_lp_mean-total_cost_lp_sd), alpha=0.2, fill = "grey70") +
geom_line(data=ate_data, aes(budget_v, cost_ate_mean, colour="ATE")) +
geom_ribbon(data=ate_data, aes(x=budget_v, y=cost_ate_mean,ymin=cost_ate_mean+cost_ate_sd, ymax=cost_ate_mean-cost_ate_sd), alpha=0.2, fill = "grey70") +
labs(x = "Budget in $", y = "Cost of Treatment", title ="Graph of Budget Vs. Cost of Treatment", color='Allocation Methods') +
ggsave("./plots/plots_ci/plot_cost.png", width = 8, height = 5)
ggplot() +
geom_line(data=greedy_data, aes(budget_v, budget_left_mean, colour="Greedy Algorithm")) +
geom_ribbon(data=greedy_data, aes(x=budget_v, y=budget_left_mean,ymin=budget_left_mean+budget_left_sd, ymax=budget_left_mean-budget_left_sd), alpha=0.2, fill = "grey70") +
geom_line(data=lp_data, aes(budget_v, budget_left_mean, colour="HTE_MAX")) +
geom_ribbon(data=lp_data, aes(x=budget_v, y=budget_left_mean,ymin=budget_left_mean+budget_left_sd, ymax=budget_left_mean-budget_left_sd), alpha=0.2, fill = "grey70") +
geom_line(data=ate_data, aes(budget_v, left_budget_mean, colour="ATE")) +
geom_ribbon(data=ate_data, aes(x=budget_v, y=left_budget_mean,ymin=left_budget_mean+left_budget_sd, ymax=left_budget_mean-left_budget_sd), alpha=0.2, fill = "grey70") +
labs(x = "Budget in $", y = "Left over budget in $", title ="Graph of Budget Vs. Left over budget in $", color='Allocation Methods') +
ggsave("./plots/plots_ci/plot_left_budget.png", width = 8, height = 5)
setwd('C:\\Users\\Sandeep Kumar\\Google Drive\\Ed Research\\Heterogenous treatment effects\\LP Final')
library(dplyr)
library(ggplot2)
library(reshape2)
utility_data <- read.csv('./files/utility_output.csv')
benefit <- utility_data %>% select(alt_output,equi_output,ego_output)
mean <- c(mean(benefit$alt_output),mean(benefit$equi_output),mean(benefit$ego_output))
standard_deviation <- c(sd(benefit$alt_output),sd(benefit$equi_output),sd(benefit$ego_output))
median <- c(median(benefit$alt_output),median(benefit$equi_output),median(benefit$ego_output))
third_quartile <- c(quantile(benefit$alt_output,0.75),quantile(benefit$equi_output,0.75),quantile(benefit$ego_output,0.75))
first_quartile <- c(quantile(benefit$alt_output,0.25),quantile(benefit$equi_output,0.25),quantile(benefit$ego_output,0.25))
ben_stats <- rbind(mean,standard_deviation,median,third_quartile,first_quartile)
benefit <- melt(benefit)
benefit <- benefit %>% mutate(Treatment_type = ifelse(
variable=='alt_output','Altruistic',ifelse(
variable=='equi_output','Equitable','Egoistic')))
ggplot(benefit, aes(x=Treatment_type,y=value, color=Treatment_type)) + geom_boxplot() +
labs(y='Benefit in $', title='Boxplot of Benefit') +
ggsave("./plots/stats/plot_benefit.png", width = 8, height = 5)
cost <- utility_data %>% select(alt_cost,equi_cost,ego_cost)
mean <- c(mean(cost$alt_cost),mean(cost$equi_cost),mean(cost$ego_cost))
standard_deviation <- c(sd(cost$alt_cost),sd(cost$equi_cost),sd(cost$ego_cost))
median <- c(median(cost$alt_cost),median(cost$equi_cost),median(cost$ego_cost))
third_quartile <- c(quantile(cost$alt_cost,0.75),quantile(cost$equi_cost,0.75),quantile(cost$ego_cost,0.75))
first_quartile <- c(quantile(cost$alt_cost,0.25),quantile(cost$equi_cost,0.25),quantile(cost$ego_cost,0.25))
cost_stats <- rbind(mean,standard_deviation,median,third_quartile,first_quartile)
cost <- melt(cost)
cost <- cost %>% mutate(Treatment_type = ifelse(
variable=='alt_cost','Altruistic',ifelse(
variable=='equi_cost','Equitable','Egoistic')))
ggplot(cost, aes(x=Treatment_type,y=value, color=Treatment_type)) + geom_boxplot() +
labs(y='Cost in $', title='Boxplot of Cost') +
ggsave("./plots/stats/plot_cost.png", width = 8, height = 5)
utility <- utility_data %>% select(alt_cost,equi_cost,ego_cost,alt_output,equi_output,ego_output) %>%
mutate(alt_utility = alt_output-alt_cost) %>%
mutate(equi_utility = equi_output-equi_cost) %>%
mutate(ego_utility = ego_output-ego_cost) %>%
select(alt_utility,equi_utility,ego_utility)
mean <- c(mean(utility$alt_utility),mean(utility$equi_utility),mean(utility$ego_utility))
standard_deviation <- c(sd(utility$alt_utility),sd(utility$equi_utility),sd(utility$ego_utility))
median <- c(median(utility$alt_utility),median(utility$equi_utility),median(utility$ego_utility))
third_quartile <- c(quantile(utility$alt_utility,0.75),quantile(utility$equi_utility,0.75),quantile(utility$ego_utility,0.75))
first_quartile <- c(quantile(utility$alt_utility,0.25),quantile(utility$equi_utility,0.25),quantile(utility$ego_utility,0.25))
utility_stats <- rbind(mean,standard_deviation,median,third_quartile,first_quartile)
utility <- melt(utility)
utility <- utility %>% mutate(Treatment_type = ifelse(
variable=='alt_utility','Altruistic',ifelse(
variable=='equi_utility','Equitable','Egoistic')))
ggplot(utility, aes(x=Treatment_type,y=value, color=Treatment_type)) + geom_boxplot() +
labs(y='Utility in $', title='Boxplot of Utility') +
ggsave("./plots/stats/plot_utility.png", width = 8, height = 5)
mean <- c(mean(utility$alt_utility),mean(utility$equi_utility),mean(utility$ego_utility))
utility <- utility_data %>% select(alt_cost,equi_cost,ego_cost,alt_output,equi_output,ego_output) %>%
mutate(alt_utility = alt_output-alt_cost) %>%
mutate(equi_utility = equi_output-equi_cost) %>%
mutate(ego_utility = ego_output-ego_cost) %>%
select(alt_utility,equi_utility,ego_utility)
mean <- c(mean(utility$alt_utility),mean(utility$equi_utility),mean(utility$ego_utility))
mean
data.frame('a'=1,'b'=2,'c'=3)
uti_mean <- data.frame('Altruistic'=mean(utility$alt_utility),'Egoistic'=mean(utility$equi_utility),'Equitable'=mean(utility$ego_utility))
uti_mean
uti_mean <- data.frame(c('Altruistic','Egoistic','Equitable'), mean)
uti_mean
uti_mean <- data.frame(Treatment = c('Altruistic','Egoistic','Equitable'), mean)
uti_mean
ggplot(uti_mean) + geom_bar(aes(x=Treatment, y=mean))
uti_mean <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic'), mean)
ggplot(uti_mean) + geom_bar(aes(x=Treatment, y=mean))
ggplot(uti_mean) + geom_bar(aes(x=Treatment, y=mean))+ geom_bar(stat="identity")
ggplot(uti_mean) + geom_bar(aes(x=Treatment, y=mean), stat = identity)
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(stat = identity)
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(stat = 'identity')
mean
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(aes(size=2),stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(width=1,stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(width=0.5,stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(width=0.5,color = 'blue',stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(width=0.5,fill = 'blue',stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(width=0.5,fill = 'green',stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(width=0.5,fill = 'dark_green',stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(width=0.5,fill = 'red',stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(width=0.5,fill = 'blue',stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(width=0.5,stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
library(lpSolveAPI)
setwd('C:\\Users\\ganga020\\Google Drive\\Ed Research\\Heterogenous treatment effects\\LP Final')
library(dplyr)
# Benefit(Treatment effect) matrix for all users, I have users as row indices and treatments as column indices
utility_data_1 <- read.csv('./files/utility_output.csv')
set.seed(1)
utility_data <- sample_n(utility_data_1, 1000)
benefit_m <- as.matrix(utility_data %>% select(alt_output,equi_output,ego_output))
cost_m <- as.matrix(utility_data %>% select(alt_cost,equi_cost,ego_cost))
# Total no. of possible treatments
n_treatments <- ncol(benefit_m)
# Total no of users
n_users <- nrow(benefit_m)
# Total no of decisions to be made, which user should be assigned to which treatment
n_decisions <- n_users*n_treatments
# Total available budget
# budget <- 1000
# Calculating total utility. Here I am considering the utility as total benefit-total cost
utility_m <- benefit_m - cost_m
utility_v <- c(utility_m)
lp_func <- function (custom_budget) {
# Initializing the linear programming function
lprec<-make.lp(0,n_decisions)
# Initializing the objective function
# The objective function here is the maximization of (total benefit - total cost) i.e. total utility
set.objfn(lprec, utility_v)
# Adding constarints
# 1: Each user can be assigned to only one treatment.
# 2. Total cost cannot exceed budget.
# 3. Each user can only be assigned to one treatment only once
# Adding constraint 1
# 1: Each user can be assigned to maximum one treatment.
rep.col<-function(x,n){
matrix(rep(x,each=n), ncol=n, byrow=TRUE)
}
I <- diag(n_users)
for(i in 1:n_users){
add.constraint(lprec, c(rep.col(I[,i],n_treatments)), "<=", 1)
}
# Adding constraint 2
# 2. Total cost cannot exceed budget.
add.constraint(lprec, c(cost_m), "<=", custom_budget)
# Adding constraint 3
# 3. set the type of decision variables to binary
set.type(lprec,1:n_decisions,"binary")
# set the LP solver preference to maximization (instead of minimization)
lp.control(lprec,sense='max')
# set time limit
lp.control(lprec, timeout = 60)
# Visually check the model, write the model to a text file
write.lp(lprec,'./files/lpmodel_opt.txt',type='lp')
# solve the model
# The output '0' means that there is a solution
solve(lprec)
# Final result
# This matrix shows which user is allocated what treatment under the set constraints
# We can see that many users are not allocated any treatment because of constrained budget.
assign_matrix <- matrix(get.variables(lprec),nrow=n_users)
# save the results in a csv
write.csv(matrix(get.variables(lprec),nrow=n_users),"./files/lp_opt_solution_1.csv")
utility_assign_matrix <- utility_m * assign_matrix
cost_assign_matrix <- cost_m * assign_matrix
users_served <- sum(c(assign_matrix))
total_utility_lp <- sum(c(utility_assign_matrix))
total_cost_lp <- sum(c(cost_assign_matrix))
budget_left = custom_budget - total_cost_lp
return (c(users_served, total_utility_lp, total_cost_lp, budget_left))
}
#lp_func(30)
budget_v <- 50
#budget_v <- 10
lp_solution <- sapply(budget_v, lp_func)
transpose_dataframe <- data.frame(t(lp_solution))
colnames(transpose_dataframe) <- c('users_served', 'total_utility_lp', 'total_cost_lp', 'budget_left')
transpose_dataframe$budget_v <- budget_v
ggplot(user_mean,aes(x=Treatment, y=mean)) + geom_bar(width=0.5,stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
user_mean <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic'), user = c(450,4, 124))
ggplot(user_mean,aes(x=Treatment, y=mean)) + geom_bar(width=0.5,stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
user_mean <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic'), user = c(450,4, 124))
ggplot(user_mean,aes(x=Treatment, y=mean)) + geom_bar(width=0.5,stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_user.png", width = 8, height = 5)
user_mean <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic'), user = c(450,4, 124))
ggplot(user_mean,aes(x=Treatment, y=user)) + geom_bar(width=0.5,stat = 'identity') +
labs(y='No. of users', x= 'Treatment Condition',title='Plot of No. of users assigned to different Treatment conditions in HTE-MAX') +
ggsave("./plots/stats_p/plot_user.png", width = 8, height = 5)
uti_mean <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic'), mean)
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(width=0.5,stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
lp_data
View(lp_data)
View(ate_data)
library(dplyr)
library(treeClust)
setwd('C:\\Users\\Sandeep Kumar\\Google Drive\\Ed Research\\Heterogenous treatment effects\\LP Final')
source('./code/berry_function.R')
# Reading the raw data
data <- read.csv('./data/collage_raw.csv')
# Filtering out the users who do not open email
data <- data %>% filter(emailopen_b == 1)
data[c("cell","satisfied","survey")] <- lapply(data[c("cell","satisfied","survey")], factor)
# Creating benefit and cost columns based on coupon purchases
collage_data <- data %>% mutate(benefit = referrer_money_spend+friend_money_spend) %>% mutate(cost = ifelse(benefit>0,10,0))
# Assiging different treatment conditions
control_placeholder <- '1'
egoistic_placeholder <- '2'
equitable_placeholder <- '3'
altruistic_placeholder <- '4'
# Benefit Treatment effect for altruistic model
alt_output <- berry2s(
data = collage_data,
control_group_placeholder = control_placeholder,
treatment_group_placeholder = altruistic_placeholder,
treatment_variable = "cell",
target_variable = "benefit",
covariates = c("satisfied","NPS","lastday_purchase_all","num_purchase_all","money_spend_all","survey"),
covariate_factors = c("cell","satisfied","survey"))
ben_c <- predict(alt_output[[3]], collage_data)
tau <- predict(alt_output[[1]], collage_data)
leaf_no_t <- predict(alt_output[[2]], collage_data)
alt_data <- data.frame(leaf_no_t, tau, ben_c)
alt_data <- alt_data %>% group_by(tau) %>% mutate(alt_ben = mean(ben_c)) %>% ungroup()
alt_data <- alt_data %>% mutate(alt_output = alt_ben+tau)
alt_data <- alt_data %>% mutate(cost = collage_data$cost) %>% group_by(tau) %>% mutate(alt_cost = mean(cost)) %>% ungroup()
ben_c <- predict(alt_output[[3]], collage_data)
tau <- predict(alt_output[[1]], collage_data)
leaf_no_t <- predict(alt_output[[2]], collage_data)
alt_data <- data.frame(leaf_no_t, tau, ben_c)
alt_data <- alt_data %>% group_by(tau) %>% mutate(alt_ben = mean(ben_c)) %>% ungroup()
alt_data <- alt_data %>% mutate(alt_output = alt_ben+tau)
alt_data <- alt_data %>% mutate(cost = collage_data$cost) %>% group_by(tau) %>% mutate(alt_cost = mean(cost)) %>% ungroup()
View(alt_data)
typeof(collage_data$cost)
length(collage_data$cost)
alt_data <- alt_data %>% mutate(cost = collage_data$cost)
alt_data <- alt_data %>% mutate(cost = as.vector(collage_data$cost))
alt_data <- alt_data %>% mutate(cost = as.vector(collage_data$cost)) %>% group_by(tau) %>% mutate(alt_cost = mean(cost)) %>% ungroup()
alt_data <- alt_data %>% group_by(ben_c) %>% mutate(ben_cost = mean(cost)) %>% ungroup()
write.csv(alt_data,'./files/alt_output.csv')
utility_data <- cbind(alt_data, equi_data, ego_data)
write.csv(utility_data,'./files/utility_output.csv')
write.csv(alt_data,'./files/alt_output.csv')
# # Benefit Treatment effect for egoistic model
ego_output <- berry2s(
data = collage_data,
control_group_placeholder = control_placeholder,
treatment_group_placeholder = egoistic_placeholder,
treatment_variable = "cell",
target_variable = "benefit",
covariates = c("satisfied","NPS","lastday_purchase_all","num_purchase_all","money_spend_all","survey"),
covariate_factors = c("cell","satisfied","survey"))
ben_c <- predict(ego_output[[3]], collage_data)
tau <- predict(ego_output[[1]], collage_data)
leaf_no_t <- predict(ego_output[[2]], collage_data)
ego_data <- data.frame(leaf_no_t, tau, ben_c)
ego_data <- ego_data %>% group_by(tau) %>% mutate(ego_ben = mean(ben_c)) %>% ungroup()
ego_data <- ego_data %>% mutate(ego_output = ego_ben+tau)
ego_data <- ego_data %>% mutate(cost = as.vector(collage_data$cost)) %>% group_by(tau) %>% mutate(ego_cost = mean(cost)) %>% ungroup()
write.csv(ego_data,'./files/ego_output.csv')
# write.csv(ego_output[[2]],'./files/ego_output.csv')
# collage_data['ego_output'] <- ego_output[[2]]
# collage_data['ego_leaf'] <- leaf.numbers(ego_output[[1]])
# collage_data <- collage_data %>% group_by(ego_leaf) %>% mutate(ego_cost = mean(cost)) %>% ungroup()
# Benefit Treatment effect for equitable model
equi_output <- berry2s(
data = collage_data,
control_group_placeholder = control_placeholder,
treatment_group_placeholder = equitable_placeholder,
treatment_variable = "cell",
target_variable = "benefit",
covariates = c("satisfied","NPS","lastday_purchase_all","num_purchase_all","money_spend_all","survey"),
covariate_factors = c("cell","satisfied","survey"))
ben_c <- predict(equi_output[[3]], collage_data)
tau <- predict(equi_output[[1]], collage_data)
leaf_no_t <- predict(equi_output[[2]], collage_data)
equi_data <- data.frame(leaf_no_t, tau, ben_c)
equi_data <- equi_data %>% group_by(tau) %>% mutate(equi_ben = mean(ben_c)) %>% ungroup()
equi_data <- equi_data %>% mutate(equi_output = equi_ben+tau)
equi_data <- equi_data %>% mutate(cost = as.vector(collage_data$cost)) %>% group_by(tau) %>% mutate(equi_cost = mean(cost)) %>% ungroup()
write.csv(equi_data,'./files/equi_output.csv')
# write.csv(equi_output[[2]],'./files/equi_output.csv')
# collage_data['equi_output'] <- equi_output[[2]]
# collage_data['equi_leaf'] <- leaf.numbers(equi_output[[1]])
# collage_data <- collage_data %>% group_by(equi_leaf) %>% mutate(equi_cost = mean(cost)) %>% ungroup()
utility_data <- cbind(alt_data, equi_data, ego_data)
write.csv(utility_data,'./files/utility_output.csv')
#
# # Cost Treatment effect for altruistic model
#
# alt_c_output <- berry2s(
#   data = collage_data,
#   control_group_placeholder = control_placeholder,
#   treatment_group_placeholder = altruistic_placeholder,
#   treatment_variable = "cell",
#   target_variable = "cost",
#   covariates = c("satisfied","NPS","lastday_purchase_all","num_purchase_all","money_spend_all","survey"),
#   covariate_factors = c("cell","satisfied","survey"))
# d <- data.frame(alt_c_output)
# write.csv(d,'./files/alt_c_output.csv')
#
# # Cost Treatment effect for egoistic model
#
# ego_c_output <- berry2s(
#   data = collage_data,
#   control_group_placeholder = control_placeholder,
#   treatment_group_placeholder = egoistic_placeholder,
#   treatment_variable = "cell",
#   target_variable = "cost",
#   covariates = c("satisfied","NPS","lastday_purchase_all","num_purchase_all","money_spend_all","survey"),
#   covariate_factors = c("cell","satisfied","survey"))
# e <- data.frame(ego_c_output)
# write.csv(e,'./files/ego_c_output.csv')
#
# # Cost Treatment effect for equitable model
#
# equi_c_output <- berry2s(
#   data = collage_data,
#   control_group_placeholder = control_placeholder,
#   treatment_group_placeholder = equitable_placeholder,
#   treatment_variable = "cell",
#   target_variable = "cost",
#   covariates = c("satisfied","NPS","lastday_purchase_all","num_purchase_all","money_spend_all","survey"),
#   covariate_factors = c("cell","satisfied","survey"))
# f <- data.frame(equi_c_output)
# write.csv(f,'./files/equi_c_output.csv')
setwd('C:\\Users\\Sandeep Kumar\\Google Drive\\Ed Research\\Heterogenous treatment effects\\LP Final')
library(dplyr)
library(ggplot2)
library(reshape2)
utility_data <- read.csv('./files/utility_output.csv')
benefit <- utility_data %>% select(alt_output,equi_output,ego_output)
mean <- c(mean(benefit$alt_output),mean(benefit$equi_output),mean(benefit$ego_output))
standard_deviation <- c(sd(benefit$alt_output),sd(benefit$equi_output),sd(benefit$ego_output))
median <- c(median(benefit$alt_output),median(benefit$equi_output),median(benefit$ego_output))
third_quartile <- c(quantile(benefit$alt_output,0.75),quantile(benefit$equi_output,0.75),quantile(benefit$ego_output,0.75))
first_quartile <- c(quantile(benefit$alt_output,0.25),quantile(benefit$equi_output,0.25),quantile(benefit$ego_output,0.25))
ben_stats <- rbind(mean,standard_deviation,median,third_quartile,first_quartile)
benefit <- melt(benefit)
benefit <- benefit %>% mutate(Treatment_type = ifelse(
variable=='alt_output','Altruistic',ifelse(
variable=='equi_output','Equitable','Egoistic')))
ggplot(benefit, aes(x=Treatment_type,y=value, color=Treatment_type)) + geom_boxplot() +
labs(y='Benefit in $', title='Boxplot of Benefit') +
ggsave("./plots/stats/plot_benefit.png", width = 8, height = 5)
cost <- utility_data %>% select(alt_cost,equi_cost,ego_cost)
mean <- c(mean(cost$alt_cost),mean(cost$equi_cost),mean(cost$ego_cost))
standard_deviation <- c(sd(cost$alt_cost),sd(cost$equi_cost),sd(cost$ego_cost))
median <- c(median(cost$alt_cost),median(cost$equi_cost),median(cost$ego_cost))
third_quartile <- c(quantile(cost$alt_cost,0.75),quantile(cost$equi_cost,0.75),quantile(cost$ego_cost,0.75))
first_quartile <- c(quantile(cost$alt_cost,0.25),quantile(cost$equi_cost,0.25),quantile(cost$ego_cost,0.25))
cost_stats <- rbind(mean,standard_deviation,median,third_quartile,first_quartile)
cost <- melt(cost)
cost <- cost %>% mutate(Treatment_type = ifelse(
variable=='alt_cost','Altruistic',ifelse(
variable=='equi_cost','Equitable','Egoistic')))
ggplot(cost, aes(x=Treatment_type,y=value, color=Treatment_type)) + geom_boxplot() +
labs(y='Cost in $', title='Boxplot of Cost') +
ggsave("./plots/stats/plot_cost.png", width = 8, height = 5)
utility <- utility_data %>% select(alt_cost,equi_cost,ego_cost,alt_output,equi_output,ego_output) %>%
mutate(alt_utility = alt_output-alt_cost) %>%
mutate(equi_utility = equi_output-equi_cost) %>%
mutate(ego_utility = ego_output-ego_cost) %>%
mutate(con_utility = ben_c - ben_cost) %>%
select(alt_utility,equi_utility,ego_utility)
utility_data
View(utility_data)
utility <- utility_data %>% select(alt_cost,equi_cost,ego_cost,alt_output,equi_output,ego_output) %>%
mutate(alt_utility = alt_output-alt_cost) %>%
mutate(equi_utility = equi_output-equi_cost) %>%
mutate(ego_utility = ego_output-ego_cost) %>%
mutate(con_utility = ben_c-ben_cost) %>%
select(alt_utility,equi_utility,ego_utility)
utility <- utility_data %>% select(alt_cost,equi_cost,ego_cost,alt_output,equi_output,ego_output,ben_c,ben_cost) %>%
mutate(alt_utility = alt_output-alt_cost) %>%
mutate(equi_utility = equi_output-equi_cost) %>%
mutate(ego_utility = ego_output-ego_cost) %>%
mutate(con_utility = ben_c-ben_cost) %>%
select(alt_utility,equi_utility,ego_utility)
mean <- c(mean(utility$alt_utility),mean(utility$equi_utility),mean(utility$ego_utility),mean(utility$con_utility))
utility <- utility_data %>% select(alt_cost,equi_cost,ego_cost,alt_output,equi_output,ego_output,ben_c,ben_cost) %>%
mutate(alt_utility = alt_output-alt_cost) %>%
mutate(equi_utility = equi_output-equi_cost) %>%
mutate(ego_utility = ego_output-ego_cost) %>%
mutate(con_utility = ben_c-ben_cost) %>%
select(alt_utility,equi_utility,ego_utility)
utility
utility <- utility_data %>% select(alt_cost,equi_cost,ego_cost,alt_output,equi_output,ego_output,ben_c,ben_cost) %>%
mutate(alt_utility = alt_output-alt_cost) %>%
mutate(equi_utility = equi_output-equi_cost) %>%
mutate(ego_utility = ego_output-ego_cost) %>%
mutate(con_utility = ben_c-ben_cost) %>%
select(alt_utility,equi_utility,ego_utility,con_utility)
mean <- c(mean(utility$alt_utility),mean(utility$equi_utility),mean(utility$ego_utility),mean(utility$con_utility))
uti_mean <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic', 'Control'), mean)
uti_mean
ggplot(uti_mean,aes(x=Treatment, y=mean)) + geom_bar(width=0.5,stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
uti_mean <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic', 'Control'), mean)
ggplot(uti_mean,aes(x=reorder(Treatment,-mean), y=mean)) + geom_bar(width=0.5,stat = 'identity') +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_ate.png", width = 8, height = 5)
t.test(utility$alt_utility,utility$con_utility, paired = TRUE)
t.test(utility$equi_utility,utility$con_utility, paired = TRUE)
t.test(utility$ego_utility,utility$con_utility, paired = TRUE)
max <- c(0.4754024,0.1458753,0.2185998)
min <- c(0.4142375,0.1062017,0.1721807)
mid <- c(0.4448199,0.1260385,0.1953903)
con_plot <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic'), mid, min, max)
ggplot(con_plot,aes(x=reorder(Treatment,-mid), y=mean)) + geom_bar(width=0.5,stat = 'identity') +
geom_errorbar(mapping=aes(x=reorder(Treatment,-mid), ymin=mid+max, ymax=mid-min), width=0.2, size=1, color="blue") +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_conf.png", width = 8, height = 5)
con_plot <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic'), mid, min, max)
ggplot(con_plot,aes(x=reorder(Treatment,-mid), y=mean)) + geom_bar(width=0.5,stat = 'identity') +
geom_errorbar(mapping=aes(x=reorder(Treatment,-mid), ymin=mid+max, ymax=mid-min), size=1, color="blue") +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_conf.png", width = 8, height = 5)
con_plot
con_plot <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic'), mid, min, max)
ggplot(con_plot,aes(x=reorder(Treatment,-mid), y=mean)) + geom_bar(width=0.5,stat = 'identity') +
geom_errorbar(mapping=aes(x=reorder(Treatment,-mid), ymin=mid+max, ymax=mid-min), color="blue") +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_conf.png", width = 8, height = 5)
ggplot(con_plot,aes(x=reorder(Treatment,-mid), y=mean)) + geom_bar(width=0.5,stat = 'identity') +
#geom_errorbar(mapping=aes(x=reorder(Treatment,-mid), ymin=mid+max, ymax=mid-min), color="blue") +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_conf.png", width = 8, height = 5)
con_plot <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic'), mid, min, max)
ggplot(con_plot,aes(x=reorder(Treatment,-mid), y=mean)) + geom_bar(width=0.5,stat = 'identity') +
#geom_errorbar(mapping=aes(x=reorder(Treatment,-mid), ymin=mid+max, ymax=mid-min), color="blue") +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_conf.png", width = 8, height = 5)
mid <- c(0.4448199,0.1260385,0.1953903)
con_plot <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic'), mid, min, max)
ggplot(con_plot,aes(x=reorder(Treatment,-mid), y=mid)) + geom_bar(width=0.5,stat = 'identity') +
geom_errorbar(mapping=aes(x=reorder(Treatment,-mid), ymin=mid+max, ymax=mid-min), color="blue") +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_conf.png", width = 8, height = 5)
con_plot <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic'), mid, min, max)
ggplot(con_plot,aes(x=reorder(Treatment,-mid), y=mid)) + geom_bar(width=0.5,stat = 'identity') +
geom_errorbar(mapping=aes(x=reorder(Treatment,-mid), ymin=max, ymax=min), color="blue") +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_conf.png", width = 8, height = 5)
ggplot(con_plot,aes(x=reorder(Treatment,-mid), y=mid)) + geom_bar(width=0.5,stat = 'identity') +
geom_errorbar(mapping=aes(x=reorder(Treatment,-mid), ymin=max, ymax=min),width=0.2, size=1, color="blue") +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_conf.png", width = 8, height = 5)
con_plot <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic'), mid, min, max)
ggplot(con_plot,aes(x=reorder(Treatment,-mid), y=mid)) + geom_bar(width=0.5,stat = 'identity') +
geom_errorbar(mapping=aes(x=reorder(Treatment,-mid), ymin=max, ymax=min),width=0.2, size=1) +
labs(y='Average Utility', x= 'Treatment Condition',title='Plot of Avg. Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_conf.png", width = 8, height = 5)
max <- c(0.4754024,0.1458753,0.2185998)
min <- c(0.4142375,0.1062017,0.1721807)
mid <- c(0.4448199,0.1260385,0.1953903)
con_plot <- data.frame(Treatment = c('Altruistic','Equitable','Egoistic'), mid, min, max)
ggplot(con_plot,aes(x=reorder(Treatment,-mid), y=mid)) + geom_bar(width=0.5,stat = 'identity') +
geom_errorbar(mapping=aes(x=reorder(Treatment,-mid), ymin=max, ymax=min),width=0.2, size=1) +
labs(y='Marginal Utility', x= 'Treatment Condition',title='Plot of Marginal Utility for different Treatment conditions') +
ggsave("./plots/stats_p/plot_conf.png", width = 8, height = 5)
